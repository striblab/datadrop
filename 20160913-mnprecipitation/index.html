<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Minnesota Precipitation</title>
  <meta name="description" content="Minnesota Precipitation">
  <meta name="author" content="Frey Hargarten - StarTribune">
  
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.23.0/mapbox-gl.css' rel='stylesheet' />
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.0.0/mapbox-gl-geocoder.css' type='text/css' />
  
  <style>
      body, #filter, #filter input:focus { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
      #chart .c3-line { stroke-width:6px !important; }

      #map { width:100%; height:400px; }
      #map_blocks { width:100%; height:650px; }
      .map-overlay-container { position: absolute; width:400px; top: 0; left: 0; padding: 10px; z-index: 1; }
      .map-overlay { font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; background-color: #fff; border-radius: 3px; padding: 10px; box-shadow:0 1px 2px rgba(0,0,0,0.20); }
      .map-overlay h2, .map-overlay p { margin: 0 0 10px; }
      .mapboxgl-ctrl-attrib { display:none; }

      #wrapper { text-align:center; width:100%; }

      #viewSwitch, #current { padding:10px; }
      .stat { font-weight:900; }

      #filter { padding:12px; }

      #chart { height:250px; }

      .source { font-size:0.8em; }

      #blurb { text-align:center; padding:15px; }
      #visitors { font-weight:900; color:#66AF50; }
      #parkname { font-weight:900; }

      #filter input { border-radius:0 !important; width:100% !important; }
      #filter { padding:0px !important; }

      p { text-align:center; margin-right:auto; margin-left:auto; padding:15px; }

      #geocoder-container, #geocoder-container2 { width:100%; margin-top:10px; }
      #geocoder-container > div, #geocoder-container2 > div { min-width:100%; margin-left:0; }

      #parksList { height:164px; overflow:auto; }
      .zoom { float:none !important; text-align:center; padding:15px; }

      .switch { padding:10px; display:inline-block; text-align:center; width:100%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; color:#000 !important; margin:0 !important; }
      .switch:hover, .selected, .step:hover { background-color:#4C4C39 !important; color:#fff !important; cursor:pointer; margin:0 !important; }

      .play { background-color:#fff !important; color:#000; }
      .pause { background-color:#333 !important; color:#fff; }
      #diverse { color:#299129; }
   
      #toggle { margin:0; padding:0; width:80px; height:23px; font-size:2em; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; border:0; font-weight:900; margin-left:auto; margin-right:auto; display:block; }
      #toggle:hover { background-color:#333 !important; color:#fff; cursor:pointer; }
      .navButtons { display:block; text-align:center; background-color:#fff !important; width:40px; font-size:2em; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; border:0; font-weight:900; }
      .navButtons:hover { background-color:#333 !important; color:#fff; cursor:pointer; }
      .previous { float:left; }
      .next { float:right; }

      #tracker { padding-top:10px; text-align:center; }
      .trackDot { border-radius:50%; width:10px; height:10px; display:inline-block; margin:6px; background-color:#ddd; }
      .trackDot:hover, .current { background-color:#333; cursor:pointer; }
      .dot { border-radius:50%; width:15px; height:15px; text-align:center; margin-right:auto; margin-left:auto; }

      #box { text-align:center; }

      .map-overlay-container { position:static; }
      .map-overlay { font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; background-color: #fff; border-radius: 3px; padding: 10px; box-shadow:0 1px 2px rgba(0,0,0,0.20); }
      .map-overlay h2, .map-overlay p { margin: 0 0 10px; }

      .controls { display:inline-block; width:49.5% !important; vertical-align:top; }

      @media (max-width:500px) {
      #map, #map2 { position:static; height:400px; }
      .map-overlay-container { width:100%; position:static; }
      .bottom { position:static; width:100%; clear:both; }
      .controls { display:block; width:100% !important; vertical-align:top; }
      }
  </style> 
</head>

<body>
<div id="blocks" class="dataviz">
<div id="map_blocks"></div>
<div id='geocoder-container2'></div>

<div class="breaker"></div>

<div id="quantize">
<span class='legend' id="aidQ">
  <nav class='legend clearfix'>
    <h4>Precipitation recorded by station</h4>
    <span style='background:#fff;'>Less</span>
    <span style='background:#ADD6F0;'></span>
    <span style='background:#7FB9DE;'></span>
    <span style='background:#25516E'></span>
    <span style='background:#fff;'>More</span>
</span>
</div>

<div class="breaker"></div>

<div class="zoom">Reset View</div>
</div>

</div>

</div>
<!-- <p><small class="byline">Data Visualization by <a href="http://www.startribune.com/jeff-hargarten/274254381/" target="new_">Jeff Hargarten</a></small></p> -->
</body>

<script src="//code.jquery.com/jquery-latest.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.23.0/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.0.0/mapbox-gl-geocoder.js'></script>

<script>
d3.json('./shapefiles/stations.geojson', function(error, spots) {

//MAPPAGE BLOCKS
mapboxgl.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiS3pwY1JTMCJ9.pTSXx_LFgR3XBpCNNxWPKA';
var map2 = new mapboxgl.Map({
    container: 'map_blocks',
    style: 'mapbox://styles/shadowflare/ciqzo0bu20004bknkbrhrm6wf',
    center: [-94.6859, 46.729553],
    zoom: 5.4,
    minZoom: 2
});

var geocoder2 = new mapboxgl.Geocoder({
    container: 'geocoder-container2' // Optional. Specify a unique container for the control to be added to.
});


$(".zoom").click(function() {
map2.flyTo({ center: [-94.6859, 46.729553], zoom: 5.4 });
});

map2.scrollZoom.disable();
map2.addControl(geocoder2);
map2.addControl(new mapboxgl.Navigation());

map2.on('load', function() {
$(".mapboxgl-ctrl-geocoder input").attr("placeholder","Search by city or address");

geocoder2.on('result', function(ev) {
  map2.flyTo({ center: ev.result.geometry.coordinates, zoom: 14 });
    });


    // map2.addSource("spots", {
    //     type: "geojson",
    //     data: spots
    // });

    map2.addSource("spots", {
        type: "geojson",
        // Point to GeoJSON data. This example visualizes all M1.0+ earthquakes
        // from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.
        data: "./shapefiles/stations.geojson"
        // cluster: true,
        // clusterMaxZoom: 15, // Max zoom to cluster points on
        // clusterRadius: 20 // Use small cluster radius for the heatmap look
    });

 // var layers = [
 //        [0, '#D3F0F9'],
 //        [20, '#00BFFF'],
 //        [40, '#0084B0']
 //    ];

 //    layers.forEach(function (layer, i) {
        map2.addLayer({
            "id": "cluster",
            "type": "circle",
            "source": "spots",
            "paint": {
                "circle-color": {
                property: 'PRECIP',
                stops: [
                [0, '#ADD6F0'],
                [15, '#7FB9DE'],
                [20, '#25516E']]
                },
                "circle-radius": 4,
                // {
                // property: 'PRECIP',
                // stops: [
                // [0, 5],
                // [5, 10],
                // [10, 15],
                // [15, 20],
                // [20, 25]]
                // },
                "circle-opacity": 1,
                "circle-blur": 0 
            }
            // "filter": i === layers.length - 1 ?
            //     [">=", "point_count", layer[0]] :
            //     ["all",
            //         [">=", "point_count", layer[0]],
            //         ["<", "point_count", layers[i + 1][0]]]
        }, 'waterway-label');
    // });

//2010
    // map2.addLayer({
    //             "id": "blocks-layer2010",
    //             "type": "circle",
    //             "source": "spots",
    //             "paint": {
    //               'circle-radius': 3,
    //               'circle-color': '#00BFFF'
    //         //     'fill-antialias' : true,
    //         //     'fill-opacity': 1,
    //         //     'fill-outline-color': 'rgba(51, 51, 51, 1)',
    //         //     "fill-color": {
    //         //     property: 'A2010',
    //         //     // type: 'categorical',
    //         //     stops: [
    //         //         [0, '#D3F0F9'],
    //         //         [50, '#33CAFC'],
    //         //         [55, '#00BFFF'],
    //         //         [65, '#006384'],
    //         //         [69, '#001319']]
    //         // }
    //             }
    // });


});
});

</script>
</html>