<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Retrospective Summary Report Lookup</title>
  <meta name="description" content="FDA medical device retrospective summary report database lookup">
  <meta name="author" content="CJ Sinner - StarTribune">

  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  
  <style>
       .button { padding:10px; display:inline-block; text-align:center; width:100%; background-color:#fff; font-weight:500; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border: none; border-bottom: 1px solid #999; }
       .button:hover, .selected { background-color:#eee !important; cursor:pointer; color:#000 !important; margin:0 !important; }
       .button { float:left; }
       #filter { font-family:"Benton Sans"; font-size:.9em; margin:5px; }
       #filter input { width: 100% !important; padding: 0 10px 0 10px; font-family:"Benton Sans"; border-radius:0 !important; margin:0; width:100%; height:30px; line-height:120%; font-size: 1em; -webkit-appearance: none;
         -webkit-border-radius:0; border-radius:0; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); color: rgba(0,0,0,0.75);  -webkit-transition: all 0.30s ease-in-out; -moz-transition: all 0.30s ease-in-out; -ms-transition: all 0.30s ease-in-out; -o-transition: all 0.30s ease-in-out; background-color: #fff !important; font-family: inherit; border: 1px solid #eee !important; 
         background-size: 14px 14px;
         background-repeat: no-repeat; 
         background-position: 98% 50%; }
       #filter input:focus { width: 100% !important; font-family:"Benton Sans"; box-shadow: 0 0 5px #999; padding: 1px 10px 1px 10px; border: 1px solid #61bd1a ; }

      .title{
        font-size: 1.9em;
        font-family:"Poynter Serif RE",Georgia,Times,serif;
      }

      .descrip{
        width: 95%;
        margin: auto;
        margin-top: 25px;
        margin-bottom: 35px;
        line-height: 1em;
      }


       #info, .title{
        text-align: center;
        margin: auto;
      }

      .filters p{
        font-family:"Poynter Serif RE",Georgia,Times,serif;
        margin-top: 20px;
        width: 95%;
        margin: auto;
      }

       .filters ul li {
          float: left;
          list-style: none;
          padding: 10px 16px;
       }

       .filters button{
        font-family: "Benton Sans",Helvetica,Arial,sans-serif;
        background-color: white;
        padding: 7px 10px;
        text-decoration: none;
        text-align: center;
        border-radius: 8px;
        border: 1px solid #eee;
       }

       .filters button:hover, .reset:hover{
        background-color: #f2f2f2;
       }

       .clearfix{
        clear: both;
        text-align: right;
       }

      .reset{
        margin-top: 40px;
        font-family: "Benton Sans",Helvetica,Arial,sans-serif;
        font-size: .7em;
        background-color: white;
        padding: 5px 7px;
        text-decoration: none;
        text-align: center;
        border-radius: 5px;
        border: 1px solid #eee;
      }

       #deviceList{
        height: 195px;
        overflow: auto;
        margin-bottom: 35px;
       }

      #info{
        width: 70%;
      }

       .num{
        font-size: 1.9em;
        font-family:"Poynter Serif RE",Georgia,Times,serif;
        color: #C22A22;
       }

       #lag, #device{
        font-weight: bold;
       }

       a#FDA{
        text-decoration: underline;
        color: black;
       }

       a#FDA:hover{
        text-decoration: underline;
        color: #ccc;
       }

      .resources{clear: both; padding-top: 60px;}

      .resources p{
        line-height: .8em;
      }

      .resources a{
        color: black;
      }

      .resources a:hover{
        color: grey;
      }

      @media (max-width: 475px){

      }

      @media (max-width:370px) { 

    }

  </style> 
</head>

<body>
<div id="wrapper">

  <h2 class="title">Find a medical device report</h2>
  <div class="descrip">
  <p>The Food & Drug Administration allows medical device companies to summarize numerous adverse events in a single public filing, contrary to typical practice.</p>
  <p>The Star Tribune discovered more than 300 such retrospective summary reports filed by more than two dozen companies between 2005 and 2015. Search them below.<p>
  </div>
  <div class="filters">
    <p>See devices from these major companies:</p>
    <ul>
      <li><button class="company" company="Baxter">Baxter</button></li>
      <li><button class="company" company="(GE)">GE</button></li>
      <li><button class="company" company="Medtronic">Medtronic</button></li>
      <li><button class="company" company="Stryker">Stryker</button></li>
      <li><button class="company" company="Zimmer">Zimmer</button></li>
    </ul>
  </div>
<!--   <div class="filters clearfix sortfloat">
    <p>Devices with the largest number of events reported:</p>
    <button class="sort" id="eventSort" sortBy="numEvents">Sort</button>
  </div>
  <div class="filters sortfloat">
    <p>Devices with longest lag time before reporting to FDA:</p>
    <button class="sort" id="lagSort" sortBy="lag">Sort</button>
  </div>
 --><div class="clearfix">
    <button class="reset">Reset</button>
  </div>
  <div id="filter"><input type="search" id="filter_box" placeholder="Search a company or medical device"></input></div>
  <div id="deviceList">
  <!--Database list of device manufacturers and device names that are clickable to scorecard-->
  </div>

  <div id="info">
    <p><span id="manufName"></span> summarized</p>
    <p id="reports" class="num"></p>
    <p>adverse events for their <span id="device"></span> device in a retrospective summary report to the FDA on <span id="date"></span>.</p>
    <p>It took the company <span id="lag"></span> days to file with the FDA after first learning of the events. Law says they're supposed to tell the FDA about adverse events within 30 days.</p>
    <p>Read the full <a href="#" id="FDA" target="_blank">FDA report here</a>.</p>

    <div class="resources">
      <p><small><a href="https://github.com/striblab/datadrop/tree/gh-pages/20161017-rsr" target="_blank">View on Github</a> | <a href='https://docs.google.com/spreadsheets/d/1RlvqHMyepBysg8EEWg7veUQdOiLmLh8l3nYhhSVgNYY/pub?output=xlsx' target='new_'>Download the Data</a></small></p>
      <p><small><em>The Star Tribune identified public Food & Drug Administration files using a <a href="http://deviceevents.com/" target="_blank">proprietary search tool</a> created by Device Events, Inc.</em></small></p>
      <p><small><em>Database compiled by Joe Carlson, dashboard by C.J. Sinner, Star Tribune</em></small></p>
    </div>
  </div>

</div>
</body>

<script src="//code.jquery.com/jquery-latest.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
// $("#headerDiv").sticky({topSpacing:1});

</script>
<script>
//LIVE JSON MAGIC

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=1cJMavlb8PBBlbRngyzmZaG5A0yjltFwhGw0KDOC91vA&sheet=strikes
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=1cJMavlb8PBBlbRngyzmZaG5A0yjltFwhGw0KDOC91vA&sheet=airports

// d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1RlvqHMyepBysg8EEWg7veUQdOiLmLh8l3nYhhSVgNYY&sheet=rsr", function(error, dataLoad) {

d3.json("./data/rsr.json", function(error, dataLoad) {

var data = dataLoad.rsr;

var currentDevice = "";


 d3.select("#deviceList").selectAll(".list")
  .data(data).enter().append("div")
  .attr("class","list")
  .attr("data",function(d){ return d.id; })
  .on("click", function(d, i){
    $("#manufName").html(d.manuf);
    $("#device").html(d.deviceName);
    $("#reports").html(d3.format(",")(d.numEvents));
    $("#lag").html(d3.format(",")(d.lag));
    $("#date").html(d3.time.format("%B %e, %Y")(new Date(d.receiveDate)));
    $("#FDA").attr("href",d.maudeLink);
    // $("#readpay").html(d3.format("$,")(d.readmImpact));

    // $("#readpay").html( function (){
    //   if (d.readmImpact > 0){
    //     return "<span class='red'>" + (d3.format("$,")(d.readmImpact)) + "</span>";
    //   } else {
    //     return "<span class='green'>" + (d3.format("$,")(d.readmImpact)) + "</span>";
    //   }
    // });


    })
  .html(function(d){ 
    if (currentDevice != d.combinedName){
      currentDevice=d.combinedName;
      return "<button class='button'>" + d.combinedName + "</button>";
    } else {
      return null;
    }
    });

  $( ".button:first" ).click();

  $(".button:first").addClass("selected");

  $(".button").click(function() {
  $(".button").removeClass("selected");
  $(this).addClass("selected");
  });


   $( document ).ready(function() {

    $('#filter_box').keyup(function(i){
       $('.button').hide();
       $(".button").removeClass("selected");
       var txt = String($('#filter_box').val());
       $('.button').each(function(){
          if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
              $(this).show();
          }
       });
    });

       $('.company').click(function(i){
       $('.button').hide();
       $(".button").removeClass("selected");
       $(".company").removeClass("selected");
        $(this).addClass("selected");
       var txt = String($(this).attr("company"));
       $('.button').each(function(){
          if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
              $(this).show();
          }
       });
    });

   $('.reset').click(function(){
    $('.button').show();
    // $(this).addClass("selected");
    $(".company").removeClass("selected");
   });

});

});


</script>
</html>