<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Baby Name Trends</title>
  <meta name="description" content="Baby Name Trends">
  <meta name="author" content="Frey Hargarten - StarTribune">
  
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  
  <style>
      body, #filter, #filter input:focus { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
      #chart .c3-line { stroke-width:6px !important; }

      #wrapper { text-align:center; }

      #viewSwitch, #current { padding:10px; }
      .stat { font-weight:900; }

      #filter { padding:12px; }

      .switch { padding:10px; display:inline-block; text-align:center; width:48.5%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; color:#000 !important; }
      .switch:hover, .selected, .step:hover { background-color:#4C4C39 !important; color:#fff !important; cursor:pointer; }

      @media (max-width:500px) {
      }
  </style> 
</head>

<body>
<h3>1.) Select gender:</h3>
<div id="viewSwitch">
<li class="switch" id="M" data="M">Male</li>
<li class="switch" id="F" data="F">Female</li>
</div>

<h3>2.) Enter name:</h3>
<div id="filter"><input type="search" id="filter_box" placeholder="Type name and press enter"></input></div>

  <div id="wrapper">

<div class="chartTitle">How popular is the name <span id="named"></span> in Minnesota?</div>
<div class="chatter">Rate per 10,000 <span class="stat sex"></span> births by year</div>

<div id="chart"></div>

<div id="current" class="chatter"><span class="stat" id="rate"></span> <span id="gender"></span> babies per 10,000 <span class="stat sex"></span> births in <span class="stat" id="year"></span> were named <span class="stat" id="named2"></span></div>

<small class="source">Result reflects the last year when the name's rate reached above zero.</small>
<div></div>
<small class="source">Data includes years when five babies received a certain name, so no births on the chart could mean between 0 and 4.</small>

  </div>
</body>

<script src="//code.jquery.com/jquery-latest.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>
<script>
d3.csv("./data/names.csv", function(d) {
  return {
    gender: d.GENDER,
    year: +d.YEAR,
    name: d.NAME,
    rate: +d.RatePer10k,
    births: +d.NUM_BIRTHS
  };
}, function(error, rows) {

var data = rows;

var axis = [];
var dataStream = [];
axis[0] = 'x';
var indexYear = 1;

for (var j=1910; j<2016; j++){
  axis[indexYear] = j;
  dataStream[indexYear] = 0;
  indexYear++;
}

function switchChart(name,gender,colors){

  var found = false;
  dataStream[0] = name;
  var index = 0;

  for (var i=0; i < data.length; i++){
    if (name == data[i].name && gender == data[i].gender){
      found = true;
      index = i;
      for (var k=1; k < dataStream.length; k++){
        // console.log(axis[k] + " " + data[index].year);
        if (data[index].name != name || data[index].gender != gender){ break; }
        if (axis[k] == data[index].year) { 
          dataStream[k] = data[index].rate; 
          $("#rate").html(data[index].rate);
          $("#year").html(data[index].year);
          index++; 
        }
      }
      // break;
    }
  }

  // for (var i=0; i < data.length; i++){
  //   if (name == data[i].name || gender == data[i].gender){
  //     found = true;
  //     var push = i;
  //   for (var k=1; k <= 106; k++){
  //     if (data[push].name != name){ break; }
  //     else if (data[push].year == axis[k]) { dataStream[k] = data[push].rate; push++; }
  //     else { dataStream[k] = 0; }
  //    }
  //   }
  // }

if (found == true){

  console.log(dataStream);

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 60,
    };

var share = "#B0BEC5";

console.log(axis);

var chart = c3.generate({
        bindto: '#chart',
        padding: padding,
    data: {
        x: 'x',
        columns: [
            axis,
            dataStream
        ],
        type: 'line'
    },
    color:  {  pattern: [colors] },
    axis: {
      y: {
            min: 0,
            padding: {bottom: 0},
            tick: {
             count: 4,
             format: d3.format('.1f')
            }
        },
        x: {
            tick: {
                values: ['1910', '1950', '1990', '2014'],
                count: 4,
                multiline: false
            }
          }
        },
      tooltip: {
      contents: function (d, defaultTitleFormat, defaultValueFormat, color) {
          var $$ = this, config = $$.config,
              titleFormat = config.tooltip_format_title || defaultTitleFormat,
              nameFormat = config.tooltip_format_name || function (name) { return name; },
              valueFormat = config.tooltip_format_value || defaultValueFormat,
              text, i, title, value, name, bgcolor;
          for (i = 0; i < d.length; i++) {
              if (! (d[i] && (d[i].value || d[i].value === 0))) { continue; }

              if (! text) {
                  title = titleFormat ? titleFormat(d[i].x) : d[i].x;
                  text = "<table class='" + $$.CLASS.tooltip + "'>" + (title || title === 0 ? "<tr><th colspan='2'>" + title + "</th></tr>" : "");
              }

              var birthNum = 0;



              name = nameFormat(d[i].name);
              value = valueFormat(d[i].value, d[i].ratio, d[i].id, d[i].index);
              bgcolor = $$.levelColor ? $$.levelColor(d[i].value) : color(d[i].id);

              console.log(title);

              for (var k=0; k < rows.length; k++){
                if (rows[k].name == name && rows[k].year == Number(title)){
                  birthNum = rows[k].births;
                  break;
                }
              }

              text += "<tr class='" + $$.CLASS.tooltipName + "-" + d[i].id + "'>";
              text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>" + name + "</td>";
              text += "<td class='value'>" + value + "</td>";
              text += "</tr><tr>";
              text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>Births: </td>";
              text += "<td class='value'>" + birthNum + "</td>";
              text += "</tr>";
              
          }
          return text + "</table>";
      }
    }
});
}
else { $("#current").html("Name not found"); }

}

function toTitleCase(str)
{
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}

$.urlParam = function(name){
  var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
  if (results != null) { return results[1]; }
  else { return 0; }
}

if ($.urlParam('name') != 0 ) { 
  var name = toTitleCase($.urlParam('name')); 
  var gender = String($.urlParam('gender')).toUpperCase();
  var genderStatus = gender; 
  $("#" + gender).addClass("selected");
  if (gender == "M") { var colorMe = "#67B4C2"; var sex = "boy"; var genderfull="male" }
  else  { var colorMe = "#AA6666";  var sex = "girl"; var genderfull = "female"; }
  $("#named, #named2").html(name);
  $("#gender").html(sex);
  $(".sex").html(genderfull);
  $("#named, #rate, #named2, .sex").css("color",colorMe);
  switchChart(name,gender,colorMe);
} 

  $( document ).ready(function() {
    $(".switch").click(function()  { 
       genderStatus = $(this).attr("data");
       $(".switch").removeClass("selected");
       $(this).addClass("selected");
    });

   $('#filter_box').keyup(function(e){
        if(e.keyCode == 13)
        {
          window.location.href = './?name=' + $('#filter_box').val() + '&gender=' + genderStatus;
        }
    });
    
});   

});
</script>
</html>