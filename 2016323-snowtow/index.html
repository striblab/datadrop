<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Minneapolis Snow Emergency Towings Winter 2016</title>
  <meta name="description" content="Minneapolis Snow Emergency Towings Winter 2016">
  <meta name="author" content="Frey Hargarten - StarTribune">

  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.15.0/mapbox-gl.css' rel='stylesheet' />

  <style>
   #wrapper { width:100%; }
   #map { height:450px; width:100%; }
   .mapboxgl-ctrl-attrib { display:none; }

  .switch { padding:10px; display:inline-block; text-align:center; width:24%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; }
  .switch:hover, .precinctR:hover, .precinctD:hover, .selected, .metroSwitch:hover { background-color:#333 !important; color:#fff !important; cursor:pointer; }

  #switches { text-align:center; }

  </style> 
</head>

<body>
  <div id="wrapper">
<div id="map"></div>
<div id="switches">
<div class="switch" data="one">Day 1</div>
<div class="switch" data="two">Day 2</div>
<div class="switch" data="three">Day 3</div>
<div class="switch selected" data="poi">All</div>
</div>
  </div>
</body>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.15.0/mapbox-gl.js'></script>

<script>
// $("#headerDiv").sticky({topSpacing:1});

</script>
<script>
//LIVE JSON MAGIC

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=1cJMavlb8PBBlbRngyzmZaG5A0yjltFwhGw0KDOC91vA&sheet=strikes
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=10tdXdsFANvW4dtOYJrRxRwb6NYLxaWHSmr7mTNZ8px0&sheet=snowtow2016

d3.json("./data/mpls_clean.geojson", function(error, json) {

var dataTow = json;

var layerIDs = []; // Will contain a list used to filter against.
var filterInput = document.getElementById('filter-input');
mapboxgl.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiS3pwY1JTMCJ9.pTSXx_LFgR3XBpCNNxWPKA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/shadowflare/cilea5110001ra8ktm7409xze',
    center: [-93.266667, 44.983333],
    zoom: 10
});

map.addControl(new mapboxgl.Navigation());

map.on('style.load', function () {

    map.addSource('mpls', {
        'type': 'geojson',
        'data': './shapefiles/minneapolis_neighborhoods.json'
    });

    map.addLayer({
        'id': 'states-layer',
        'interactive': true,
        'type': 'fill',
        'source': 'mpls',
        'paint': {
            'fill-color': 'rgba(200, 100, 240, 0)',
            'fill-outline-color': 'rgba(51, 51, 51, 1)'
        }
    });

    map.addSource("tows", {
        type: "geojson",
        data: dataTow
    });

    // map.addLayer({
    //     "id": "non-cluster-markers",
    //     "type": "circle",
    //     "source": "tows",
    //     "paint": {
    //             "circle-color": 'rgba(103, 180, 194, 0.3)',
    //             "circle-radius": 4
    //         }
    // });

dataTow.features.forEach(function(feature) {
        var symbol = feature.properties['day'];
        var layerID = 'poi-' + symbol;

        // Add a layer for this symbol type if it hasn't been added already.
        if (!map.getLayer(layerID)) {
            map.addLayer({
                "id": layerID,
                "type": "circle",
                "source": "tows",
                "paint": {
                    "circle-color": 'rgba(103, 180, 194, 0.45)',
                    "circle-radius": 4
                },
                "filter": ["==", "day", symbol]
            });

            layerIDs.push(layerID);
        }
    });

    $(".switch").click(function() {
        $(".switch").removeClass("selected");
        $(this).addClass("selected");
        var value = $(this).attr("data");
        layerIDs.forEach(function(layerID) {
            map.setLayoutProperty(layerID, 'visibility',
                layerID.indexOf(value) > -1 ? 'visible' : 'none');
        });
    });

});


});
</script>

</html>