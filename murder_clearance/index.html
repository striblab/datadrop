<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Minnesota Murder Clearance Rates</title>
  <meta name="description" content="Minnesota Murder Clearance Rates">
  <meta name="author" content="Frey Hargarten - StarTribune">
  
  <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  
  <style>
    body { overflow-x:hidden; font-family: "Benton Sans",Helvetica,Arial,sans-serif !important; }
    .mapbox-logo, .leaflet-control-attribution{ display:none !important; }
    .map-legend .swatch { width:20px; height:20px; float:left; margin-right:10px; }
    .leaflet-popup-close-button { display: none; }
    .leaflet-popup-content-wrapper { pointer-events: none; }
    .leaflet-top { display:none; }
    #chart { width:100%; margin:5px; height:300px; }
    #map { width:100%; margin:5px; height:450px; }
    #wrapper { width:540px; margin-left:auto; margin-right:auto; }

    #date { display:none; }

    #placeName { font-size:1.3em; font-weight:900; }
    #controls { width:100%; }
    #leftRail { width:73%; float:left; }
    #rightRail { width:25%; float:right; }
    #nerdbox { height:200px; }
    .selection { width:100%; }
    #states { fill: #aaa; }
    #state-borders { fill: none; stroke: #fff; stroke-width: 2px; stroke-linejoin: round; stroke-linecap: round; pointer-events: none; }
    .tooltip{ background-color:rgba(255,255,255,1); height: auto; width: auto; padding:10px; -webkit-border-radius:10px; -moz-border-radius:10px; border-radius:0; border: 1px solid black; font-size:13px; font-family:Arial; }
    path:hover{ fill:#333 !important; cursor:pointer; }
    #states .active:hover { fill:#333 !important; }
    .breaker { clear:both; margin:7px; }
    .myButton2 { background-color:#ddd; }
    .breaker { clear:both; margin:17px; }
    #back { float:left; font-size:1.7em; font-weight:bold; }
    #forward { float:right; font-size:1.7em; font-weight:bold; }
    #back:hover, #forward:hover { cursor:pointer; }
    .stat { width:24%; display:inline-block; font-size:1.4em;  }
    .count { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
    .label { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
    #statbox { width:100%; text-align:center; }
    #statbox div { text-align:left; }}
    #legendContainer { width:100%; }
    .legend label, .legend span { display:block; float:left; height:15px; width:35px; text-align:center; font-size:11px; color:#808080; }
    #quantize{ padding:5px; text-align:center; }
    .legend_title { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

    .homicide { color:#9e0f17; font-weight:900; }
    .clearance { color:#aaa; font-weight:900; }
    .rate { color:#C46A25; font-weight:900;}
    #date { font-weight:900; text-align:center; font-size:1em; }
    #agency { font-weight:900; font-size:1em;  }

    #viewSwitch { text-align:center; display:none; }

    .breaker { margin:-7px; }

    .myButton2 { background-color:#fff; }
    .myButton2:hover { background-color:#ddd !important;}

    .hottest { fill:#ff0000 !important; }
    .yearScrub text { background-color:#3F88C5; fill:#3F88C5 !important; pointer-events: all; color:#3F88C5;  }
    .yearScrub line { background-color:#3F88C5; fill:#3F88C5 !important; stroke:#3F88C5 !important; pointer-events: all; color:#3F88C5;  }

    #agencyList, #agencyHead { height:auto; width:100%; font-family:"Benton Sans",Helvetica,Arial,sans-serif; text-align:center; }
    .card { width:100%; font-size:0.8em; }
    .card div { display:inline-block; width:19%; text-align:left; }
    .header { display:inline-block; width:19%; text-align:left; font-weight:900; }
    .header:hover { opacity:0.8; cursor:pointer; }
    .selectSort { text-decoration:underline; }
    .tableHead { display:inline-block; width:24%; font-weight:bold; text-align:left; }

    @media only screen and (max-width:540px) {
      #wrapper { width:100%; }
    }
  </style> 
</head>

<div id="wrapper">

<div id="leftSide">

<div id="yearSwitch">
<div id="selector">
  <section class="main">
        <div class="wrapper-demo">
          <div id="dd" class="wrapper-dropdown-1" tabindex="1">
            <span id="currentYear">All</span>
              <ul class="dropdown months" tabindex="1">
               <li class="menuSwitch">All</li>
               <li class="menuSwitch">2015</li>
               <li class="menuSwitch">2014</li>
               <li class="menuSwitch">2013</li>
               <li class="menuSwitch">2012</li>
               <li class="menuSwitch">2011</li>
               <li class="menuSwitch">2010</li>
               <li class="menuSwitch">2009</li>
               <li class="menuSwitch">2008</li>
               <li class="menuSwitch">2007</li>
               <li class="menuSwitch">2006</li>
               <li class="menuSwitch">2005</li>
               <li class="menuSwitch">2004</li>
               <li class="menuSwitch">2003</li>
               <li class="menuSwitch">2002</li>
               <li class="menuSwitch">2001</li>
               <li class="menuSwitch">2000</li>
               <li class="menuSwitch">1999</li>
               <li class="menuSwitch">1998</li>
               <li class="menuSwitch">1997</li>
               <li class="menuSwitch">1996</li>
               <li class="menuSwitch">1995</li>
               <li class="menuSwitch">1994</li>
               <li class="menuSwitch">1993</li>
               <li class="menuSwitch">1992</li>
               <li class="menuSwitch">1991</li>
               <li class="menuSwitch">1990</li>
               <li class="menuSwitch">1989</li>
               <li class="menuSwitch">1988</li>
               <li class="menuSwitch">1987</li>
               <li class="menuSwitch">1986</li>
               <li class="menuSwitch">1985</li>
               <li class="menuSwitch">1984</li>
               <li class="menuSwitch">1983</li>
               <li class="menuSwitch">1981</li>
               <li class="menuSwitch">1980</li>
               <li class="menuSwitch">1979</li>
               <li class="menuSwitch">1978</li>
               <li class="menuSwitch">1977</li>
               <li class="menuSwitch">1976</li>
               <li class="menuSwitch">1975</li>
               <li class="menuSwitch">1974</li>
               <li class="menuSwitch">1973</li>
               <li class="menuSwitch">1972</li>
               <li class="menuSwitch">1971</li>
               <li class="menuSwitch">1970</li>
               <li class="menuSwitch">1969</li>
               <li class="menuSwitch">1968</li>
               <li class="menuSwitch">1967</li>
               <li class="menuSwitch">1966</li>
               <li class="menuSwitch">1965</li>
             </ul>
          </div>
        â€‹</div>
</section>
</div>
</div>

<input id="slider" type="range" min="1965" max="2016" step="1" value="2016" />

<div id="map"></div>

<div class="breaker"></div>

<div id="legendContainer">
<div id="quantize">
<span class='legend'>
  <nav class='legend clearfix'>
    <span style='background:#fff;'>Less</span>
    <span style='background:#ef575f;'></span>
    <span style='background:#eb2833;'></span>
    <span style='background:#60090e;'></span>
    <span style='background:#220305;'></span>
    <span style='background:#fff;'>More</span>
  </nav>
</span>
</div>
</div>

<div class="zoom">Reset View</div>

<div class="breaker"></div>

<!-- <div id="viewSwitch"><button class="myButton2" id="counties">Counties</button><button class="myButton2" id="cities">Cities</button></div> -->

<div id="date">2015</div>
<div class="breaker"></div>
<div id="statbox">
<div class="stat label">Agency</div>
<div class="stat label">Homicides</div>
<div class="stat label">Cleared</div>
<div class="stat label">Rate</div>
<div id="agency" class="stat">Minnesota</div>
<div id="homicidesCount" class="homicide count stat">5,422</div>
<div id="clearanceCount" class="clearance count stat">3,3599</div>
<div id="solvedPct" class="rate count stat">66.4%</div>
</div>

<div id="chart"></div>

<!-- <div style="display:none"> -->
<div id="filter"><input type="search" id="filter_box" placeholder="Search by agency or county" /></div>
<div id="agencyHead">
<div class="header selectSort" data="agency">Agency</div><div class="header" data="county">County</div><div class="header" data="murders">Homicides</div><div class="header" data="cleared">Cleared</div><div class="header" data="rate">Rate</div>
</div>
<div id="agencyList"></div>
<!-- </div> -->
</div>


</div>

<script src="//code.jquery.com/jquery-latest.js"></script>
<script src="../_common_resources/js/d3-master/d3.min.js" charset="utf-8"></script>
<script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
<script src="js/c3-master/c3.min.js"></script>

<script>
d3.json("./data/rates.json", function(error, dataLoadRates) {
d3.json("./data/years.json", function(error, dataLoadYears) {

var data = dataLoadRates.rates;
var dataYears = dataLoadYears.yearlyClearance;

listAgencies(2015);

var thisYear = "All";

function listAgencies(year){
  $("#agencyList").html("");
  d3.select("#agencyList").selectAll(".card")
  .data(data.filter(function(d){ return d.Year == year; })).enter().append("div")
  .attr("class","card")
  .html(function (d){ return "<div class='agencyName'>" + d.Agency + "</div><div class='agencyName'>" + d.County + "</div><div class='homicide'>" + d.MRD + "</div><div class='clearance'>" + d.CLR + "</div><div class='rate'>" + d3.format("%")(d.Rate) + "</div>";});

   $('.header').on('blur change click dblclick error focus focusin focusout hover keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup resize scroll select submit', function(event){ event.stopPropagation(); return false; });

    $(".header").click(function() {
      $(".header").removeClass("selectSort");
      $(this).addClass("selectSort");
      if ($(this).hasClass("toggled")) { $(this).removeClass("toggled"); var sorted = "ascend"; }
      else if ($(this).hasClass("selectSort")) { $(this).addClass("toggled"); var sorted ="descend"; } 
      tableSort("#agencyList",$(this).attr("data"),sorted);
    });

     $('#filter_box').keyup(function(i){
        $('.card').hide();
        var txt = $('#filter_box').val();
        $('.card').each(function(){
           if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
               $(this).show();
           }
        });
    });


function tableSort(container,column,sorted){
  d3.select(container).selectAll(".card").sort(function(a, b) {
          if (column == "county") { 
        if (sorted == "descend") { return d3.descending(a.County, b.County); }
        if (sorted == "ascend") { return d3.ascending(a.County, b.County); }
     }
          if (column == "agency") { 
        if (sorted == "descend") { return d3.descending(a.Agency, b.Agency); }
        if (sorted == "ascend") { return d3.ascending(a.Agency, b.Agency); }
     }
          if (column == "murders") { 
        if (sorted == "descend") { return d3.descending(a.MRD, b.MRD); }
        if (sorted == "ascend") { return d3.ascending(a.MRD, b.MRD); }
     }
           if (column == "cleared") { 
        if (sorted == "descend") { return d3.descending(a.CLR, b.CLR); }
        if (sorted == "ascend") { return d3.ascending(a.CLR, b.CLR); }
     }
           if (column == "rate") { 
        if (sorted == "descend") { return d3.ascending(a.Rate, b.Rate); }
        if (sorted == "ascend") { return d3.descending(a.Rate, b.Rate); }
     }
    })
    .transition().duration(500);
}

}


function chartMurders(){
   var count = d3.nest()
  .key(function(d) { return "Murders"; })
  .key(function(d) { return d.Year; })
  .rollup(function(v) { return d3.sum(v, function(d) { return d.MRD; }) })
  .entries(data);
    //console.log(count);
   return count;
}

function chartCleared(){
   var count = d3.nest()
  .key(function(d) { return "Cleared"; })
  .key(function(d) { return d.Year; })
  .rollup(function(v) { return d3.sum(v, function(d) { return d.CLR; }) })
  .entries(data);
    //console.log(count);
   return count;
}

function aggregateYear(year){
   var count = d3.nest()
  .key(function(d) { return d.Year == year; })
  .rollup(function(v) { return { "murders": d3.sum(v, function(d) { return d.MRD; }), "cleared": d3.sum(v, function(d) { return d.CLR; }) } })
  .entries(data);
   // console.log(count);
   return count;
}

function aggregateCounty(year,county){
   var count = d3.nest()
  .key(function(d) { return d.County == county && d.Year == year; })
  .rollup(function(v) { return { "murders": d3.sum(v, function(d) { return d.MRD; }), "cleared": d3.sum(v, function(d) { return d.CLR; }) } })
  .entries(data);
  // console.log(count.length);
  if (count.length > 1) { return count[1].values; }
  else { return 0; }
}

function aggregateAgency(year,agency){
   var count = d3.nest()
  .key(function(d) { return d.Agency == agency && d.Year == year; })
  .rollup(function(v) { return { "murders": d3.sum(v, function(d) { return d.MRD; }), "cleared": d3.sum(v, function(d) { return d.CLR; }) } })
  .entries(data);
   // console.log(count);
  if (count.length > 1) { return count[1].values; }
  else { return 0; }
}

  $.getJSON('shapefiles/counties.json', function(counties) {
    $.getJSON('shapefiles/cities.json', function(cities) {

$(document).bind('DOMNodeInserted', function(event) {
$(".agencyName").click(function() {
    var cleared = aggregateAgency(year,$(this).text()).cleared;
    var murders = aggregateAgency(year,$(this).text()).murders;
    var pct = d3.format("%")(cleared / murders);
    $("#homicidesCount").html(murders);
    $("#clearanceCount").html(cleared);
    $("#solvedPct").html(pct);

    var cityData = [{"year":year,"Cleared":cleared,"Murders":murders}]

    redrawChart(cityData,[year],false);

    $('#agency').html($(this).text());
});
 });     

$(".zoom").click(function() {
  map.setView([46.358056, -94.200833], 6);
  shifting(thisYear);
  redrawChart(dataYears,['1965', '1980', '1995', '2010', '2015'],true);
  $("#filter_box").val("");
  $('.card').show();
});

$("#counties").css("background-color","#ddd");

$("#counties").click(function() {
  map.removeLayer(cityLayer);
  map.addLayer(countyLayer);
  $(".myButton2").css("background-color","white");
  $(this).css("background-color","#ddd");
});
$("#cities").click(function() {
  map.removeLayer(countyLayer);
  map.addLayer(cityLayer);
  $(".myButton2").css("background-color","white");
  $(this).css("background-color","#ddd");
});

$(".menuSwitch").click(function() {
  var value = Number($(this).text());
  $("#slider").val(value);
  thisYear = value;
  shifting(value);
});

function shifting(value){
  if (value != "All" && value != "2016"){
  var murders = aggregateYear(value)[1].values.murders;
  var cleared = aggregateYear(value)[1].values.cleared;
  var pct = cleared / murders;

  listAgencies(value);
  redrawChart(dataYears,thisYear,true);
  

  $("#date").html(value);
  $("#homicidesCount").html(d3.format(",")(murders));
  $("#clearanceCount").html(d3.format(",")(cleared));
  $("#solvedPct").html(d3.format("%")(pct));
 }
else {
  $("#date").html("Total");
  $("#homicidesCount").html("5,422");
  $("#clearanceCount").html("3,599");
  $("#solvedPct").html("66.4%");
}
 $('#agency').html("Minnesota");
  map.setView([46.358056, -94.200833], 6);
  countyLayer.eachLayer(function (layer) {      
    layer.setStyle(getStyle(layer.feature,value)); 
});
//   cityLayer.eachLayer(function (layer) {      
//     layer.setStyle(getStyle2(layer.feature)); 
// });
}


$( document ).ready(function() { 
  $('#slider').on("change mousemove", function() { 
    if ($(this).val() == 2016) { $("#currentYear").html("All"); }
    else { $("#currentYear").html($(this).val()); }
    thisYear = $(this).val(); 
    shifting($(this).val()); 
  });
});

//trendline for counties
//scrubber line on chart for years
//fix agency list sort
//fix agency list total
//get 2016 data
//story navigation
//write chatter

redrawChart(dataYears,thisYear,true);

//INITIALIZE MAP
var mapBounds = new L.LatLngBounds(
              new L.LatLng(39.1982, -128.1445),
              new L.LatLng(50.5414, -68.2031));

L.mapbox.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiODRHdjBSWSJ9.lF4ymp-69zdGvZ5X4Tokzg';
  var map = L.mapbox.map('map', 'mapbox.light')
    .setView([46.358056, -94.200833], 6);

// map.dragging.disable();
map.touchZoom.disable();
map.doubleClickZoom.disable();
map.scrollWheelZoom.disable();

var popup = new L.Popup({ autoPan: false });

cityLayer = L.geoJson(cities,  {
      style: getStyle2,
      onEachFeature: onEachFeature2
  });

countyLayer = L.geoJson(counties,  {
      style: getStyle,
      onEachFeature: onEachFeature
  }).addTo(map);


  function getStyle2(feature,year) {
      return {
          weight: .2,
          opacity: 1,
          color: '#333',
          fillOpacity: .3,
          fillColor: getColor2(feature.properties.Name,2015)
      };
  }

  // get color depending on population density value
  function getColor2(d,year) {
    var cleared = aggregateAgency(2015,d).cleared;
    var murders = aggregateAgency(2015,d).murders;
    var colorMe2 = cleared / murders;
                return colorMe2 >= .50  ? '#220305' :
          colorMe2 >= .30  ? '#60090e' :
          colorMe2 >= .10  ? '#eb2833' :
          colorMe2 >= 0  ? '#ef575f' :
          '#ddd';
  }

//MAP INTERACTIONS
  function onEachFeature2(feature, layer) {
      layer.on({
          mousemove: mousemove2,
          mouseout: mouseout2,
          click: zoomToFeature2
      });
  }

   function mousemove2(e) {
      var layer = e.target;
      popup.setLatLng(e.latlng);
         var cleared = aggregateAgency(thisYear,layer.feature.properties.Name).cleared;
         var murders = aggregateAgency(thisYear,layer.feature.properties.Name).murders;
         var pct = d3.format("%")(cleared / murders);

            if (murders !== undefined) { popup.setContent("<div>" + layer.feature.properties.Name + " - " + thisYear + "</div><div class='homicide'>Murders: " + murders + "</div><div class='clearance'>Cleared: " + cleared + "</div><div class='rate'>Rate: " + pct + "</div>"); }
            else { popup.setContent("<div>" + layer.feature.properties.Name + " - " + thisYear + "</div>"); }
    

      if (!popup._map) popup.openOn(map);
      window.clearTimeout(closeTooltip);

      // highlight feature
      layer.setStyle({
          color: '#f00'
      });

      if (!L.Browser.ie && !L.Browser.opera) {
          layer.bringToFront();
      }
  }

  function mouseout2(e) {
      //statesLayer.resetStyle(e.target);
      var layer = e.target;
       layer.setStyle({
           color: "#333"
       });
      closeTooltip = window.setTimeout(function() {
          map.closePopup();
      }, 100);
  }

function zoomToFeature2(e) {
    var layer = e.target;
      map.fitBounds(layer.getBounds());
         var cleared = aggregateAgency(thisYear,layer.feature.properties.Name).cleared;
         var murders = aggregateAgency(thisYear,layer.feature.properties.Name).murders;
         var pct = d3.format("%")(cleared / murders);

         $("#filter_box").val(layer.feature.properties.COUNTYNAME);
         $('.card').hide();
         var txt = layer.feature.properties.COUNTYNAME;
         $('.card').each(function(){
             if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
                 $(this).show();
             }
         });

    if (murders !== undefined) {
      $("#homicidesCount").html(murders);
      $("#clearanceCount").html(cleared);
      $("#solvedPct").html(pct);

    var cityData = [{"year":thisYear,"Cleared":cleared,"Murders":murders}];

    redrawChart(cityData,[thisYear],false);
    }
    else {
      $("#homicidesCount").html("0");
      $("#clearanceCount").html("0");
      $("#solvedPct").html("-");

    var cityData = [{"year":thisYear,"Cleared":cleared,"Murders":murders}]

    redrawChart(cityData,[thisYear],false);
    }
      $('#agency').html(layer.feature.properties.Name);
      // statesLayer.resetStyle(e.target);

      // layer.setStyle({
      //     fillColor: "#f00",
      //     fillOpacity: 1
      // });
  }

  function getStyle(feature,year) {
      return {
          weight: .2,
          opacity: 1,
          color: '#333',
          fillOpacity: .3,
          fillColor: getColor(feature.properties.COUNTYNAME,year)
      };
  }

  // get color depending on population density value
  function getColor(d,year) {
    var colorMe = aggregateCounty(year,String(d)).cleared / aggregateCounty(year,String(d)).murders;
                return colorMe >= .50  ? '#220305' :
          colorMe >= .30  ? '#60090e' :
          colorMe >= .10  ? '#eb2833' :
          colorMe >= 0  ? '#ef575f' :
          '#ddd';
  }

//MAP INTERACTIONS
  function onEachFeature(feature, layer) {
      layer.on({
          mousemove: mousemove,
          mouseout: mouseout,
          click: zoomToFeature
      });
  }

  var closeTooltip;

  function mousemove(e) {
      var layer = e.target;
      popup.setLatLng(e.latlng);
         var cleared = aggregateCounty(thisYear,layer.feature.properties.COUNTYNAME).cleared;
         var murders = aggregateCounty(thisYear,layer.feature.properties.COUNTYNAME).murders;
         var pct = d3.format("%")(cleared / murders);

            if (murders !== undefined) { popup.setContent("<div>" + layer.feature.properties.COUNTYNAME + " - " + thisYear + "</div><div class='homicide'>Murders: " + murders + "</div><div class='clearance'>Cleared: " + cleared + "</div><div class='rate'>Rate: " + pct + "</div>"); }
            else { popup.setContent("<div>" + layer.feature.properties.COUNTYNAME + " - " + thisYear + "</div>"); }
    

      if (!popup._map) popup.openOn(map);
      window.clearTimeout(closeTooltip);

      // highlight feature
      layer.setStyle({
          color: '#f00'
      });

      if (!L.Browser.ie && !L.Browser.opera) {
          layer.bringToFront();
      }
  }

  function mouseout(e) {
      //statesLayer.resetStyle(e.target);
      var layer = e.target;
       layer.setStyle({
           color: "#333"
       });
      closeTooltip = window.setTimeout(function() {
          map.closePopup();
      }, 100);
  }

  function zoomToFeature(e) {
    var layer = e.target;
      map.fitBounds(layer.getBounds());
         var cleared = aggregateCounty(thisYear,layer.feature.properties.COUNTYNAME).cleared;
         var murders = aggregateCounty(thisYear,layer.feature.properties.COUNTYNAME).murders;
         var pct = d3.format("%")(cleared / murders);
    
         $("#filter_box").val(layer.feature.properties.COUNTYNAME);
         $('.card').hide();
         var txt = layer.feature.properties.COUNTYNAME;
         $('.card').each(function(){
             if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
                 $(this).show();
             }
         });

    if (murders !== undefined) {
      $("#homicidesCount").html(murders);
      $("#clearanceCount").html(cleared);
      $("#solvedPct").html(pct);

    var countyData = [{"year":thisYear,"Cleared":cleared,"Murders":murders}];

    redrawChart(countyData,[thisYear],false);
    }
    else {
      $("#homicidesCount").html("0");
      $("#clearanceCount").html("0");
      $("#solvedPct").html("-");

    var countyData = [{"year":thisYear,"Cleared":cleared,"Murders":murders}];

    redrawChart(countyData,[thisYear],false);
    }
      $('#agency').html(layer.feature.properties.COUNTYNAME);
      // statesLayer.resetStyle(e.target);

      // layer.setStyle({
      //     fillColor: "#f00",
      //     fillOpacity: 1
      // });
  }
});
});


function redrawChart(dataReload,year,allYears){

  if (allYears == true){
var  padding = {
        top: 40,
        right: 40,
        bottom: 30,
        left: 40,
    };

    console.log(year)

var chart = c3.generate({
        bindto: '#chart',
        padding: padding,
        data: {
            json: dataYears,
            keys: {
                x: 'year',
                value: ['Murders',"Cleared"]
            },
            names: {
              data1: 'Murders',
              data2: 'Cleared',
            },
           type: 'line'
        },
            point: {
              r: 0
          }, 
        bar: { width: { ratio: 0.08 } }, 
        color: { pattern: ['#9e0f17', '#aaa', "#C46A25"] },
        axis: {
            x: {
               tick: { fit: true, values: ['1965', '1980', '1995', '2010', '2015'] }
            },
            y : {
            padding: { top: 2, bottom: 0 },
        }
       },
        grid: {
            x: {
              lines: [
                {value: Number(year), text: '', position: 'start', class: 'yearScrub'}
            ]
          }
        },
      regions: [
        {axis: 'x', start: 1990, end: 2000, class: 'hottest'}
    ]
    });
}

else {
    var  padding = {
            top: 40,
            right: 40,
            bottom: 30,
            left: 40,
        };

    var chart = c3.generate({
            bindto: '#chart',
            padding: padding,
            data: {
                json: dataReload,
                keys: {
                    x: 'year',
                    value: ['Murders',"Cleared"]
                },
                names: {
                  data1: 'Murders',
                  data2: 'Cleared',
                },
               type: 'bar'
            },
                point: {
                  r: 0
              }, 
            bar: { width: { ratio: 0.08 } }, 
            color: { pattern: ['#9e0f17', '#aaa', "#C46A25"] },
            axis: {
                x: {
                   tick: { fit: true, values: [year] }
                },
                y : {
                padding: { top: 2, bottom: 0 },
            }
           },
          grid: {
            x: {
              lines: [
                {value: Number(year), text: '', position: 'start'}
            ]
          }
        },
       regions: [
        {axis: 'x', start: 1990, end: 2000, class: 'hottest', class: 'yearScrub'}
        ]
        });
    }
}

});
});
</script>
<script>
      function DropDown(el) {
        this.dd = el;
        this.placeholder = this.dd.children('span');
        this.opts = this.dd.find('ul.dropdown > li');
        this.val = '';
        this.index = -1;
        this.initEvents();
      }
      DropDown.prototype = {
        initEvents : function() {
          var obj = this;

          obj.dd.on('click', function(event){
            $(this).toggleClass('active');
            return false;
          });

          obj.opts.on('click',function(){
            var opt = $(this);
            obj.val = opt.text();
            obj.index = opt.index();
            obj.placeholder.text(obj.val);
          });
        },
        getValue : function() {
          return this.val;
        },
        getIndex : function() {
          return this.index;
        }
      }

      $(function() {

        var dd = new DropDown( $('#dd') );
        var dd2 = new DropDown( $('#ddY') );

        $(document).click(function() {
          // all dropdowns
          $('.wrapper-dropdown-1').removeClass('active');
        });

      });

</script>
</body>
</html>